# Production overrides for TG Parser
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d --build
#
# Notes:
# - Base docker-compose.yml contains the full service graph.
# - This file only adds prod-appropriate knobs (restart, logging, names).

services:
  db:
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "5"

  redis:
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "5"

  migrate:
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  bot:
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "5"

  worker:
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "5"

  api:
    restart: unless-stopped
    ports:
      # Public bind (no SSL / no domain). Access control is SERVICE_API_TOKEN bearer.
      - "${TG_PARSER_API_PORT:-18081}:8000"
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "5"

volumes:
  pgdata:
    name: tgparser_pgdata
  redisdata:
    name: tgparser_redisdata
